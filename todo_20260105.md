# Plan: Component Library & Interaction System

## Overview

Implement a drag-and-drop component library (98 components) and visual prototyping system for DesignLibre.

---

## Comprehensive Todo Checklist

### Phase 1: Component Library Panel (MVP)

#### 1.1 Infrastructure
- [ ] Create `src/scene/components/library-component-registry.ts` - LibraryComponentRegistry class
- [ ] Create `src/scene/components/library/index.ts` - Component exports
- [ ] Create `src/ui/components/component-library-panel.ts` - Library panel UI
- [ ] Modify `src/ui/components/left-sidebar.ts` - Replace placeholder with ComponentLibraryPanel
- [ ] Modify `src/ui/components/canvas-container.ts` - Add drag-drop zone for library components
- [ ] Modify `src/runtime/designlibre-runtime.ts` - Expose library registry

#### 1.2 Core Components (15)

**Buttons (2)**
- [ ] Button - `src/scene/components/library/buttons/button.ts`
- [ ] IconButton - `src/scene/components/library/buttons/icon-button.ts`

**Layout (2)**
- [ ] Container - `src/scene/components/library/layout/container.ts`
- [ ] Grid - `src/scene/components/library/layout/grid.ts`

**Forms (3)**
- [ ] Input - `src/scene/components/library/forms/input.ts`
- [ ] Checkbox - `src/scene/components/library/forms/checkbox.ts`
- [ ] Select - `src/scene/components/library/forms/select.ts`

**Navigation (2)**
- [ ] Navbar - `src/scene/components/library/navigation/navbar.ts`
- [ ] Tabs - `src/scene/components/library/navigation/tabs.ts`

**Typography (2)**
- [ ] Heading - `src/scene/components/library/typography/heading.ts`
- [ ] Text - `src/scene/components/library/typography/text.ts`

**Data Display (2)**
- [ ] Card - `src/scene/components/library/data-display/card.ts`
- [ ] Badge - `src/scene/components/library/data-display/badge.ts`

**Feedback (2)**
- [ ] Alert - `src/scene/components/library/feedback/alert.ts`
- [ ] Spinner - `src/scene/components/library/feedback/spinner.ts`

---

### Phase 2: Basic Prototype Interactions

#### 2.1 Infrastructure
- [ ] Create `src/prototype/interaction-manager.ts` - InteractionManager class
- [ ] Create `src/core/types/interaction.ts` - Interaction type definitions
- [ ] Modify `src/core/types/page-schema.ts` - Add interactions to page schema
- [ ] Modify `src/persistence/document-serializer.ts` - Save/load interactions

#### 2.2 Prototype Inspector UI
- [ ] Modify `src/ui/components/inspector-panel.ts` - Replace prototype placeholder (lines 1262-1309)
- [ ] Create `src/ui/components/frame-picker.ts` - Frame destination picker
- [ ] Create `src/ui/components/prototype-link-overlay.ts` - Visual arrows overlay

#### 2.3 Basic Triggers & Actions
- [ ] onClick trigger implementation
- [ ] onHover trigger implementation
- [ ] Navigate action implementation
- [ ] OpenOverlay action implementation
- [ ] Dissolve animation
- [ ] SmartAnimate animation

---

### Phase 3: Overlays & Advanced Actions

#### 3.1 Overlay System
- [ ] Overlay position presets (center, top-left, bottom-center, etc.)
- [ ] Overlay backdrop options (none, dim, blur)
- [ ] Close on outside click toggle
- [ ] CloseOverlay action
- [ ] Back action (navigation history)

#### 3.2 Multiple Actions
- [ ] Action list with add/remove/reorder UI
- [ ] Wait/delay between actions
- [ ] Action sequencing

#### 3.3 Additional Triggers
- [ ] onHoverEnd trigger
- [ ] onDrag trigger
- [ ] afterDelay trigger (timeout)
- [ ] onMouseDown/onMouseUp triggers
- [ ] onKeyDown trigger (key binding input)
- [ ] onFocus/onBlur triggers
- [ ] onScroll trigger
- [ ] onViewportEnter/onViewportLeave triggers

#### 3.4 Additional Animations
- [ ] MoveIn animation (with direction)
- [ ] MoveOut animation (with direction)
- [ ] Push animation
- [ ] SlideIn/SlideOut animations
- [ ] Scale animation
- [ ] Flip animation
- [ ] Custom easing curves (EaseIn, EaseOut, EaseInOut, Spring, Bounce)
- [ ] Animation duration/delay configuration

---

### Phase 4: Variables & Conditions

#### 4.1 Variable Manager
- [ ] Create `src/prototype/variable-manager.ts` - VariableManager class
- [ ] Variable types (boolean, number, string)
- [ ] Default values configuration
- [ ] Document/page scope
- [ ] Variables panel UI

#### 4.2 SetVariable Action
- [ ] Variable picker UI
- [ ] Value input (literal)
- [ ] Expression support
- [ ] Increment/decrement number values
- [ ] Toggle boolean values

#### 4.3 Conditional Actions
- [ ] Condition builder UI
- [ ] Variable-based conditions
- [ ] Comparison operators (equals, not equals, greater, less, contains)
- [ ] Multiple conditions (AND/OR)
- [ ] Conditional action branching

---

### Phase 5: Remaining Components (83)

#### Layout (10 remaining)
- [ ] Frame - `src/scene/components/library/layout/frame.ts`
- [ ] AutoLayout (Stack) - `src/scene/components/library/layout/auto-layout.ts`
- [ ] Section - `src/scene/components/library/layout/section.ts`
- [ ] Divider - `src/scene/components/library/layout/divider.ts`
- [ ] Spacer - `src/scene/components/library/layout/spacer.ts`
- [ ] AspectRatio - `src/scene/components/library/layout/aspect-ratio.ts`
- [ ] ScrollArea - `src/scene/components/library/layout/scroll-area.ts`
- [ ] ResponsiveHideShow - `src/scene/components/library/layout/responsive-hide-show.ts`
- [ ] Center - `src/scene/components/library/layout/center.ts`
- [ ] AbsolutePosition - `src/scene/components/library/layout/absolute-position.ts`

#### Navigation (6 remaining)
- [ ] Sidebar - `src/scene/components/library/navigation/sidebar.ts`
- [ ] NavLink - `src/scene/components/library/navigation/nav-link.ts`
- [ ] NavGroup - `src/scene/components/library/navigation/nav-group.ts`
- [ ] Breadcrumbs - `src/scene/components/library/navigation/breadcrumbs.ts`
- [ ] Pagination - `src/scene/components/library/navigation/pagination.ts`
- [ ] Stepper - `src/scene/components/library/navigation/stepper.ts`

#### Typography (8 remaining)
- [ ] RichText - `src/scene/components/library/typography/rich-text.ts`
- [ ] Link - `src/scene/components/library/typography/link.ts`
- [ ] Label - `src/scene/components/library/typography/label.ts`
- [ ] List - `src/scene/components/library/typography/list.ts`
- [ ] Blockquote - `src/scene/components/library/typography/blockquote.ts`
- [ ] Code - `src/scene/components/library/typography/code.ts`
- [ ] Kbd - `src/scene/components/library/typography/kbd.ts`
- [ ] Highlight - `src/scene/components/library/typography/highlight.ts`

#### Buttons (4 remaining)
- [ ] ButtonGroup - `src/scene/components/library/buttons/button-group.ts`
- [ ] SplitButton - `src/scene/components/library/buttons/split-button.ts`
- [ ] FAB (Floating Action Button) - `src/scene/components/library/buttons/fab.ts`
- [ ] ToggleButton - `src/scene/components/library/buttons/toggle-button.ts`

#### Forms (13 remaining)
- [ ] Textarea - `src/scene/components/library/forms/textarea.ts`
- [ ] Radio - `src/scene/components/library/forms/radio.ts`
- [ ] RadioGroup - `src/scene/components/library/forms/radio-group.ts`
- [ ] Switch - `src/scene/components/library/forms/switch.ts`
- [ ] Slider - `src/scene/components/library/forms/slider.ts`
- [ ] ColorPicker - `src/scene/components/library/forms/color-picker.ts`
- [ ] DatePicker - `src/scene/components/library/forms/date-picker.ts`
- [ ] FileUpload - `src/scene/components/library/forms/file-upload.ts`
- [ ] OTPInput - `src/scene/components/library/forms/otp-input.ts`
- [ ] FormField - `src/scene/components/library/forms/form-field.ts`
- [ ] Form - `src/scene/components/library/forms/form.ts`
- [ ] SearchInput - `src/scene/components/library/forms/search-input.ts`
- [ ] NumberInput - `src/scene/components/library/forms/number-input.ts`

#### Data Display (12 remaining)
- [ ] Avatar - `src/scene/components/library/data-display/avatar.ts`
- [ ] AvatarGroup - `src/scene/components/library/data-display/avatar-group.ts`
- [ ] Tag - `src/scene/components/library/data-display/tag.ts`
- [ ] Stat - `src/scene/components/library/data-display/stat.ts`
- [ ] Table - `src/scene/components/library/data-display/table.ts`
- [ ] DataList - `src/scene/components/library/data-display/data-list.ts`
- [ ] Timeline - `src/scene/components/library/data-display/timeline.ts`
- [ ] Accordion - `src/scene/components/library/data-display/accordion.ts`
- [ ] Tree - `src/scene/components/library/data-display/tree.ts`
- [ ] Calendar - `src/scene/components/library/data-display/calendar.ts`
- [ ] EmptyState - `src/scene/components/library/data-display/empty-state.ts`
- [ ] Skeleton - `src/scene/components/library/data-display/skeleton.ts`

#### Feedback (6 remaining)
- [ ] Toast - `src/scene/components/library/feedback/toast.ts`
- [ ] ProgressBar - `src/scene/components/library/feedback/progress-bar.ts`
- [ ] ProgressCircle - `src/scene/components/library/feedback/progress-circle.ts`
- [ ] Banner - `src/scene/components/library/feedback/banner.ts`
- [ ] Callout - `src/scene/components/library/feedback/callout.ts`
- [ ] Meter - `src/scene/components/library/feedback/meter.ts`
- [ ] Rating - `src/scene/components/library/feedback/rating.ts`

#### Overlays (7)
- [ ] Modal - `src/scene/components/library/overlays/modal.ts`
- [ ] Drawer - `src/scene/components/library/overlays/drawer.ts`
- [ ] Popover - `src/scene/components/library/overlays/popover.ts`
- [ ] Tooltip - `src/scene/components/library/overlays/tooltip.ts`
- [ ] DropdownMenu - `src/scene/components/library/overlays/dropdown-menu.ts`
- [ ] ContextMenu - `src/scene/components/library/overlays/context-menu.ts`
- [ ] CommandPalette - `src/scene/components/library/overlays/command-palette.ts`

#### Media (6)
- [ ] Image - `src/scene/components/library/media/image.ts`
- [ ] Video - `src/scene/components/library/media/video.ts`
- [ ] Audio - `src/scene/components/library/media/audio.ts`
- [ ] Carousel - `src/scene/components/library/media/carousel.ts`
- [ ] Lightbox - `src/scene/components/library/media/lightbox.ts`
- [ ] Gallery - `src/scene/components/library/media/gallery.ts`

#### Icons (3)
- [ ] Icon - `src/scene/components/library/icons/icon.ts`
- [ ] AnimatedIcon - `src/scene/components/library/icons/animated-icon.ts`
- [ ] IconStack - `src/scene/components/library/icons/icon-stack.ts`

#### Utility (8)
- [ ] VisuallyHidden - `src/scene/components/library/utility/visually-hidden.ts`
- [ ] FocusTrap - `src/scene/components/library/utility/focus-trap.ts`
- [ ] ClickOutside - `src/scene/components/library/utility/click-outside.ts`
- [ ] Portal - `src/scene/components/library/utility/portal.ts`
- [ ] Transition - `src/scene/components/library/utility/transition.ts`
- [ ] ScrollLock - `src/scene/components/library/utility/scroll-lock.ts`
- [ ] CopyButton - `src/scene/components/library/utility/copy-button.ts`
- [ ] QRCode - `src/scene/components/library/utility/qr-code.ts`

---

## Architecture Decisions (User Confirmed)

1. **Library Components**: LIBRARY_COMPONENT type in global registry â†’ INSTANCE nodes on canvas
2. **Interaction Storage**: Separate interaction graph (not inline in nodes)
3. **Preview Runtime**: Separate engine from editor

---

## Critical Files Reference

### Existing (Read/Understand)
- `src/scene/components/component-manager.ts` - Instance creation API
- `src/scene/components/component-registry.ts` - Component tracking
- `src/core/types/component-schema.ts` - ComponentFile structure
- `src/prototype/prototype-player.ts` - Playback runtime
- `src/prototype/interaction-handler.ts` - Trigger handling
- `src/animation/types/transition.ts` - PrototypeLink, TriggerType
- `src/ui/components/left-sidebar.ts:396` - Components placeholder
- `src/ui/components/inspector-panel.ts:1262` - Prototype placeholder

### Patterns to Follow
- `src/ui/components/layer-tree.ts` - Drag-drop tree pattern
- `src/collaboration/presence/cursor-overlay.ts` - HTML overlay pattern

---

## Component Summary by Category

| Category | Phase 1 | Phase 5 | Total |
|----------|---------|---------|-------|
| Layout | 2 | 10 | 12 |
| Navigation | 2 | 6 | 8 |
| Typography | 2 | 8 | 10 |
| Buttons | 2 | 4 | 6 |
| Forms | 3 | 13 | 16 |
| Data Display | 2 | 12 | 14 |
| Feedback | 2 | 7 | 9 |
| Overlays | 0 | 7 | 7 |
| Media | 0 | 6 | 6 |
| Icons | 0 | 3 | 3 |
| Utility | 0 | 8 | 8 |
| **Total** | **15** | **84** | **99** |

---

## Success Criteria

1. Users can drag components from library panel to canvas
2. Components instantiate correctly with proper styling
3. Users can add click-to-navigate interactions via inspector
4. Visual arrows show prototype connections
5. Preview mode plays interactions correctly
6. Interactions persist in page JSON
